# Malware Test Injection Action

Inject known malware samples into package ecosystems for security testing. This action downloads **real malware samples** from UnknownCyber's threat intelligence repository and places them in the appropriate package structure for your ecosystem.

## ⚠️ WARNING

This action downloads **REAL MALWARE SAMPLES**. Use only for:
- Testing security scanning tools
- Validating detection capabilities
- CI/CD security integration testing

**NEVER use in production environments.**

## Quick Start

```yaml
# Inject malware samples into npm packages
- uses: Unknown-Cyber-Inc/npm-package-scanner/malware-test-inject@main
  with:
    api-key: ${{ secrets.UC_API_KEY }}
    ecosystem: npm
    package-name: fake-malicious-package
```

## Inputs

| Input | Description | Required | Default |
|-------|-------------|----------|---------|
| `api-key` | UnknownCyber API key | Yes | - |
| `ecosystem` | Package ecosystem | No | `npm` |
| `package-name` | Name of fake package | No | `test-malware-sample` |
| `package-version` | Version of fake package | No | `1.0.0-infected` |
| `samples` | Sample types to download | No | `all` |
| `target-path` | Custom base path | No | ecosystem default |
| `enabled` | Enable/disable injection | No | `true` |

### Ecosystem Options

- `npm` - Places in `node_modules/<package-name>/`
- `pip` - Places in `site-packages/<package-name>/`
- `maven` - Places in `.m2/repository/com/test/<package-name>/<version>/`
- `cargo` - Places in `target/release/`
- `go` - Places in `vendor/github.com/test/<package-name>/`
- `ruby` - Places in `vendor/bundle/ruby/gems/<package-name>-<version>/`
- `nuget` - Places in `packages/<package-name>/<version>/`
- `generic` - Places in `./<package-name>/`

### Sample Types

- `obfuscated-js` - Shai Hulud obfuscated JavaScript backdoor
- `elf-malware` - Neotyxa Linux ELF malware binary
- `pe-malware` - Windows PE malware executable
- `all` - Download all available samples

## Outputs

| Output | Description |
|--------|-------------|
| `injected-path` | Path where samples were placed |
| `samples-count` | Number of samples successfully injected |
| `sample-files` | Comma-separated list of injected files |

## Examples

### Basic npm Malware Test

```yaml
name: Security Test with Malware Samples

on:
  workflow_dispatch:
    inputs:
      inject-malware:
        description: 'Inject malware samples for testing'
        type: boolean
        default: false

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - run: npm install
      
      # Inject malware samples (only when explicitly requested)
      - uses: Unknown-Cyber-Inc/npm-package-scanner/malware-test-inject@main
        if: inputs.inject-malware
        with:
          api-key: ${{ secrets.UC_API_KEY }}
          ecosystem: npm
          package-name: infected-lodash
          samples: obfuscated-js,elf-malware
      
      # Run the scanner
      - uses: Unknown-Cyber-Inc/npm-package-scanner@main
        with:
          api-key: ${{ secrets.UC_API_KEY }}
          fail-on-threats: 'true'  # This should fail when malware is detected
```

### Multi-Ecosystem Testing

```yaml
name: Multi-Ecosystem Security Test

on:
  push:
    branches: [main]

jobs:
  test-npm:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm install
      
      - uses: Unknown-Cyber-Inc/npm-package-scanner/malware-test-inject@main
        if: contains(github.event.head_commit.message, 'test-malware')
        with:
          api-key: ${{ secrets.UC_API_KEY }}
          ecosystem: npm
      
      - uses: Unknown-Cyber-Inc/npm-package-scanner@main
        with:
          api-key: ${{ secrets.UC_API_KEY }}
          ecosystems: npm
          fail-on-threats: 'true'

  test-pip:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: pip install -r requirements.txt --target=site-packages
      
      - uses: Unknown-Cyber-Inc/npm-package-scanner/malware-test-inject@main
        if: contains(github.event.head_commit.message, 'test-malware')
        with:
          api-key: ${{ secrets.UC_API_KEY }}
          ecosystem: pip
          package-name: malicious-requests
      
      - uses: Unknown-Cyber-Inc/npm-package-scanner@main
        with:
          api-key: ${{ secrets.UC_API_KEY }}
          ecosystems: pip
          fail-on-threats: 'true'
```

### Commit-Triggered Injection

```yaml
# Trigger injection only when commit message contains 'infected'
- uses: Unknown-Cyber-Inc/npm-package-scanner/malware-test-inject@main
  with:
    api-key: ${{ secrets.UC_API_KEY }}
    ecosystem: npm
    enabled: ${{ contains(github.event.head_commit.message, 'infected') }}
```

### Custom Target Path

```yaml
# Place malware in a custom directory
- uses: Unknown-Cyber-Inc/npm-package-scanner/malware-test-inject@main
  with:
    api-key: ${{ secrets.UC_API_KEY }}
    ecosystem: generic
    target-path: ./test-artifacts/malware-samples
    package-name: test-detection
```

## Available Samples

| Sample | Type | Family | Detection Engines | Description |
|--------|------|--------|-------------------|-------------|
| `obfuscated-js` | JavaScript | Shai Hulud | 45+ | Obfuscated JS backdoor |
| `elf-malware` | ELF | Neotyxa | 52+ | Linux RAT binary |
| `pe-malware` | PE | Generic | 38+ | Windows malware |

See [samples.json](./samples.json) for the full catalog.

## Security Considerations

1. **Isolated Environments**: Run tests in isolated CI/CD runners
2. **No Production Use**: Never inject samples in production systems
3. **API Key Security**: Keep your UC_API_KEY secret
4. **Review Results**: Always review scan results to verify detection

## Integration with Scanner

This action is designed to work with the [npm-package-scanner](../) action:

```yaml
# 1. Install dependencies
- run: npm install

# 2. Inject test malware
- uses: Unknown-Cyber-Inc/npm-package-scanner/malware-test-inject@main
  with:
    api-key: ${{ secrets.UC_API_KEY }}

# 3. Scan and detect
- uses: Unknown-Cyber-Inc/npm-package-scanner@main
  with:
    api-key: ${{ secrets.UC_API_KEY }}
    fail-on-threats: 'true'

# 4. Scanner should FAIL if malware is detected correctly
```

This validates that your security scanning setup is working correctly.
